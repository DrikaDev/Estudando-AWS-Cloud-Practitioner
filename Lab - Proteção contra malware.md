## üß™ Lab - Prote√ß√£o contra Malware ü¶† usando o AWS Network Firewall üß±

### **Malware** (abrevia√ß√£o de *malicious software* ou software malicioso) 
Refere-se a qualquer programa intrusivo desenvolvido por cibercriminosos (geralmente chamados de hackers) para **roubar dados, danificar ou destruir 
computadores e sistemas**.  

Exemplos comuns incluem:
- **V√≠rus**
- **Worms**
- **Cavalos de Troia**
- **Spyware**
- **Adware**
- **Ransomware**

### Firewalls  
Um **firewall** funciona como uma barreira de prote√ß√£o entre a rede interna de uma organiza√ß√£o e redes externas p√∫blicas, como a internet.  
Ele impede o acesso n√£o autorizado de usu√°rios externos √† rede interna.  

---

### Import√¢ncia do uso  
Usu√°rios corporativos precisam de acesso √† internet para atividades de neg√≥cio.  
No entanto, podem inadvertidamente baixar malware, comprometendo a **seguran√ßa da rede e dos dados**.  

Para mitigar riscos, as organiza√ß√µes adotam diferentes t√©cnicas e ferramentas, como:  
- Firewalls  
- Software antiv√≠rus  
- Boas pr√°ticas de controle de acesso e uso pelos usu√°rios  

---

## Objetivos üéØ  

Encontrar uma solu√ß√£o para **mitigar o acesso a arquivos por agentes maliciosos** da empresa XPTO.  

- üîÑ Atualizar o **firewall** da rede  
- üß± Criar um **grupo de regras** e anex√°-lo a uma **pol√≠tica de firewall**
- ‚úÖ **Verificar e testar** se o acesso a sites maliciosos est√° bloqueado

---

## Tarefa 1: Confirmar a acessibilidade

1. **Fazer login** na inst√¢ncia do EC2 **TestInstance**, pr√©-configurada durante a instala√ß√£o do laborat√≥rio.  

2. **Alterar diret√≥rios e verificar o diret√≥rio de trabalho atual** com os seguintes comandos:
```
cd ~
pwd
```

3. **Baixar a parte do malware** - de forma segura - usando o comando wget no ambiente de laborat√≥rio protegido:
> Essa etapa simula como um usu√°rio final poderia baixar um arquivo malicioso via navegador.
```
wget http://malware.wicar.org/data/js_crypto_miner.html
```

4. Nesse ambiente de laborat√≥rio protegido, insira o seguinte c√≥digo e pressione Enter para baixar o restante do malware:
```
wget http://malware.wicar.org/data/java_jre17_exec.html
```
> Esses arquivos s√£o feitos especificamente para testar anti-malware e para aprendizagem.
> N√£o os use fora deste ambiente de laborat√≥rio protegido.

5. Visualize os arquivos baixados com o comando **ls**  
   <img width="338" height="57" alt="image" src="https://github.com/user-attachments/assets/5f9da69b-2160-4214-9239-fa54843ed47e" />

6. Resumo da Tarefa:

- Confirmamos que o **URL que hospeda arquivos maliciosos** √© acess√≠vel pela rede atual e pelo **firewall de rede** da empresa XPTO.  
- Utilizanos a **inst√¢ncia EC2 TestInstance** para executar comandos e baixar os mesmos arquivos maliciosos que os usu√°rios finais poderiam acessar.  
- Pr√≥ximo passo: **corrigir o firewall de rede** da empresa para **bloquear o acesso** ao site malicioso.  

---

## Tarefa 2: inspecionar o firewall do AWS Network Firewall
> Atualizar esse firewall √© prioridade m√°xima do trabalho do engenheiro de seguran√ßa!

1. No console de gerenciamento da AWS, insira VPC na barra de pesquisa e escolha VPC.

2. No painel de navega√ß√£o √† esquerda, em NETWORK FIREWALL, selecione Firewalls.  
   Selecione LabFirewall e leia as tr√™s etapas da se√ß√£o Overview.  
   <img width="1402" height="156" alt="image" src="https://github.com/user-attachments/assets/872aa3a8-dbbd-4078-975e-2e22c0053759" />
   
4. Configurar a pol√≠tica de firewall, selecione o link 'LabFirewallPolicy' para abrir a pol√≠tica associada.
   > Uma pol√≠tica de firewall define o comportamento do firewall em uma cole√ß√£o de grupos de regra 'stateless' e 'stateful', al√©m de outras configura√ß√µes.  
   <img width="1138" height="248" alt="image" src="https://github.com/user-attachments/assets/3d9b6845-d2ea-49cb-ad97-edcd534c5e94" />

5. Na se√ß√£o **Stateless default actions**, selecione Edit.  

   Configure as op√ß√µes a seguir:  
   
- Fragmented packets: selecione 'Use the same actions for all packets'.  
- Rule action: selecione 'Forward to stateful rule groups'.  
- Clique em 'Save'.  
  
  <img width="743" height="352" alt="image" src="https://github.com/user-attachments/assets/4751c451-dabd-4159-82d6-f3e89fdcfe59" />
  <img width="1133" height="47" alt="image" src="https://github.com/user-attachments/assets/8a3b5923-3fd5-4946-93e9-d9d2986a0ab9" />

6. Resumo das a√ß√µes Stateless e Stateful:  

- Ap√≥s configurar as **a√ß√µes padr√£o stateless** e clicar em **Save**, todos os pacotes s√£o encaminhados para **grupos de regras stateful** para inspe√ß√£o detalhada.  
- **Regras stateful**: inspecionam pacotes considerando o fluxo de tr√°fego, dire√ß√£o, conex√£o existente e podem gerar logs e alertas. Permitem criar regras mais complexas, mas podem atrasar a entrega do pacote.  
- **Regras stateless**: inspecionam cada pacote individualmente, priorizando velocidade, sem considerar dire√ß√£o ou conex√£o existente.  

7. Parab√©ns: inspecionamos o firewall da rede e atualizamos a pol√≠tica de firewall.  
   Depois, atualizamos a pol√≠tica de firewall para encaminhar todos os pacotes para inspe√ß√£o de regras stateful.  

---

## Tarefa 3: criar um grupo de regras de firewall de rede com regras que bloqueiam acesso a URLs maliciosos e depois, 
anexar esse grupo de regras √† sua pol√≠tica de firewall.

> Um grupo de regras de firewall de rede √© um conjunto reutiliz√°vel de crit√©rios para inspecionar e gerenciar o tr√°fego de rede.  
> Devemos adicionar um ou mais grupos de regras a uma pol√≠tica de firewall como parte da configura√ß√£o da pol√≠tica.  
> Esse grupo de regras bloqueia o acesso aos URLs com o agente malicioso.  

1. No painel de navega√ß√£o √† esquerda, em NETWORK FIREWALL, selecione **Network Firewall Rule Groups**.  

2. Selecione **Create rule group**.  
   <img width="1418" height="349" alt="image" src="https://github.com/user-attachments/assets/c7025ec2-a86f-4165-9300-853e8d73d3cd" />

3. Na se√ß√£o **Choose rule group type**, configure as seguintes op√ß√µes:  
- Em 'Rule group type': escolha 'Stateful rule group'  
- Em 'Rule group format': escolha 'Suricata compatible rule string'  
- Em 'Rule evaluation order': escolha 'Action order'  
- Clique 'Next'  
  <img width="1150" height="465" alt="image" src="https://github.com/user-attachments/assets/ef619e8a-9da9-4efb-8161-acb4d6f6c9a3" />

4. Na se√ß√£o **Describe rule group**, configure as seguintes op√ß√µes:  
- Name: insira 'StatefulRuleGroup'
- Capacity: insira 100
- Clique 'Next'  
  <img width="1146" height="462" alt="image" src="https://github.com/user-attachments/assets/24b75323-14d2-4b4e-8c65-bb9466bc592d" />

5. Na se√ß√£o **Configure rules**, configure a seguinte op√ß√£o:  
   Em 'Suricata compatible rule string', insira o seguinte trecho de c√≥digo:  
   ```
   drop http $HOME_NET any -> $EXTERNAL_NET 80 (msg:"MALWARE custom solution"; flow: to_server,established; classtype:trojan-activity; sid:2002001; content:"/data/js_crypto_miner.html";http_uri; rev:1;)
   drop http $HOME_NET any -> $EXTERNAL_NET 80 (msg:"MALWARE custom solution"; flow: to_server,established; classtype:trojan-activity; sid:2002002; content:"/data/java_jre17_exec.html";http_uri; rev:1;)
   ```
   <img width="1135" height="224" alt="image" src="https://github.com/user-attachments/assets/711def40-85f5-47af-932b-efb064ba7fa1" />

   > Suricata √© um IPS de rede de c√≥digo aberto que inclui uma linguagem baseada em regras padr√£o para inspe√ß√£o de tr√°fego.

6. Aperte Next at√© chegar na se√ß√£o 'Review and create' e finalize clicando no bot√£o 'Create rule group'.  

7. Parab√©ns, criamos um grupo de regras de firewall de rede stateful que usa regras Suricata.  
   Ao anexar esse grupo de regras ao firewall de rede, ele bloquear√° os sites maliciosos que os usu√°rios da empresa acessarem.  

---

## Tarefa 4: anexar um grupo de regras ao firewall de rede

1. No painel de navega√ß√£o √† esquerda, em NETWORK FIREWALL, selecione Firewalls e clique em 'LabFirewall'.  
   <img width="1424" height="329" alt="image" src="https://github.com/user-attachments/assets/442395bb-ed27-4c71-8e87-5d2622db22af" />

2. Em 'LabFirewall', v√° at√© 'Associated firewall policiy' e clique em 'LabFirewallPolicy'.  
   <img width="1138" height="151" alt="image" src="https://github.com/user-attachments/assets/390bcad9-c9db-4c04-b11e-cf11bb75f701" />

3. Em 'LabFirewallPolicy', v√° at√© 'Stateless rule groups' e clique em 'Actions' - selecionando 'Add unmanaged stateful rule groups'  
   <img width="1134" height="247" alt="image" src="https://github.com/user-attachments/assets/6478562b-c31a-4c44-8773-385a62cd766b" />

4. Selecione o checkbox 'StatefulRuleGroup' e clique em 'Add stateful rule group'  
   <img width="1406" height="349" alt="image" src="https://github.com/user-attachments/assets/864a85c8-932a-4b74-88d9-94b7265733e8" />

5. Scroll down at√© 'Stateful rule groups' e veja que voc√™ atualizou o FirewallPolicy com sucesso!  
   <img width="1132" height="48" alt="image" src="https://github.com/user-attachments/assets/524e802c-dd90-40ec-bd76-51fd0b750010" />
   <img width="1172" height="161" alt="image" src="https://github.com/user-attachments/assets/a466ef71-d6d3-4504-82bb-a1dda204433d" />

> Anexamos com sucesso o grupo de regras ao firewall que bloqueia tentativas de acesso dos arquivos maliciosos hospedados dentro do site.  

---

## Tarefa 5: validar a solu√ß√£o 

1. Acesse o EC2, inst√¢ncia, selecione 'TestInstance' e clique em 'Connect'.
   <img width="1406" height="176" alt="image" src="https://github.com/user-attachments/assets/e5239052-edcd-41ff-922a-ffad9c67550a" />

2. Escolha a guia 'Session Manager' clique em 'Connect'.
   
3. Para alterar diret√≥rios e visualizar o diret√≥rio de trabalho atual, execute os seguintes comandos:
```
cd ~
pwd
```

4. Para tentar acessar o arquivo malicioso, execute o seguinte comando wget.
```
wget http://malware.wicar.org/data/js_crypto_miner.html
```
   A sa√≠da dever√° mostrar o seguinte: 'HTTP request sent, awaiting response...'
   > Esta sa√≠da mostra que o site do malware e o arquivo n√£o est√£o mais acess√≠veis e foram bloqueados com √™xito pelo firewall da rede.

5. Pressione Ctrl+c para interromper o comando. 

6. Para testar o acesso a outro URL malicioso, execute o seguinte comando:
   
```
wget http://malware.wicar.org/data/java_jre17_exec.html
```

   A sa√≠da dever√° mostrar o seguinte: 'HTTP request sent, awaiting response...'

7. Depois, para remover os arquivos de malware de teste, execute o seguinte comando:
   
```
rm java_jre17_exec.html js_crypto_miner.html
```

   Para confirmar que os arquivos foram exclu√≠dos, execute o comando 'ls'.  
   A sa√≠da dever√° estar em branco, o que confirmar√° que os arquivos foram removidos.  

8. Finalizamos tudo e com isso garantimos que os usu√°rios n√£o conseguem mais acessar arquivos maliciosos, refor√ßando a **seguran√ßa da rede da QualquerEmpresa**.

---

üëâüèª [Clique aqui para voltar ao Readme](https://github.com/DrikaDev/Estudando-AWS-Cloud-Practitioner/blob/main/README.md) üìí
